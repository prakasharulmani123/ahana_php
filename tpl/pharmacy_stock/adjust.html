<div ng-controller="stockController">
    <div class="bg-light lter b-b wrapper-md">
        <h1 class="m-n h3">Stock Adjust</h1>
    </div>
    <div class="wrapper-md">
        <div ng-include="'tpl/blocks/alert.html'">
            {% include 'tpl/blocks/alert.html' %}
        </div>
        <div class="row">
            <div class="col-sm-12" ng-init="data.search_by = 'pha_product.product_name';
                            data.search_type = 'C';
                            initForm();">
                <form name="searchForm" class="form-horizontal form-validation">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Search By</label>
                                        <div class="col-lg-9">
                                            <select class="form-control" ng-model="data.search_by" ng-options="searchBy.value as searchBy.label for searchBy in searchByLists | orderBy: label">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="line line-dashed b-b line-lg "></div>
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Search With</label>
                                        <div class="col-lg-9 col-sm-9">
                                            <div class="input-group w-md">
                                                <label class="i-checks" ng-repeat="searchType in searchTypes">
                                                    <input type="radio" checked="" value="{{searchType.value}}" name="b" ng-model="data.search_type">
                                                    <i></i>
                                                    {{searchType.label}}&nbsp; &nbsp;
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="form-group">
                                        <label class="col-lg-3 control-label">Search Text</label>
                                        <div class="col-lg-9">
                                            <input type="text" placeholder="Search Text" class="form-control" ng-model="data.search_text" focus-me="true">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <div class="text-center">
                                    <button class="btn m-b-xs  btn-success save-btn" ng-click="loadStockList()">Search</button>
                                    &nbsp;
                                    <button class="btn m-b-xs  btn-dark" ng-click="data.search_text = ''; loadStockList();"><i class="fa fa-times"></i> Cancel</button>
                                    &nbsp;
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="row" ng-show="showTable">
                    <div class="wrapper-md">

                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <b>Products List</b>
                            </div>
                            <div class="panel-body">
                                <table st-table="displayedCollection"  st-safe-src="rowCollection" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>Product Name</th>
                                            <th>Code</th>
                                            <th>P.Unit</th>
                                            <th>P.Rate</th>
                                            <!--<th>GRNO</th>-->
                                            <th>Batch No.</th>
                                            <th>Expiry Date</th>
                                            <th>S.Unit</th>
                                            <th>MRP</th>
                                            <th>Available</th>
                                            <th>Stock Adjust</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody ng-hide="isLoading">
                                        <tr ng-repeat="(key, row) in displayedCollection| orderBy: description">
                                            <td>{{row.product.full_name}}</td>
                                            <td>{{row.product.product_code}}</td>
                                            <td>{{row.product.purchasePackageName}}</td>
                                            <td>{{row.product.product_price}}</td>
                                            <!--<td>{{row.product.product_code}}</td>-->
                                            <td>{{row.batch_no}}</td>
                                            <td>{{row.expiry_date| moment:'MMM YYYY' || 'empty' }}</td>
                                            <td>{{row.product.salesPackageName}}</td>
                                            <td>{{row.mrp}}</td>
                                            <td>{{row.available_qty}}</td>
                                            <td>
                                                <span editable-text="row.add_stock" e-name="add_stock" e-form="rowform" onbeforesave="checkInput($data)" e-number-mask="" e-limit-to="7" e-required>
                                                    {{ row.add_stock || '-' }}
                                                </span>
                                            </td>
                                            <td style="white-space: nowrap">
                                                <!-- form -->
                                                <form editable-form name="rowform" onbeforesave="adjustStock($data.add_stock, row.batch_id, key)" ng-show="rowform.$visible" class="form-buttons form-inline" shown="inserted == row">
                                                    <button type="submit" ng-disabled="rowform.$waiting" class="btn btn-primary">
                                                        Save
                                                    </button>
                                                    <button type="button" ng-disabled="rowform.$waiting" ng-click="rowform.$cancel()" class="btn btn-default">
                                                        Cancel
                                                    </button>
                                                </form>
                                                <div class="buttons" ng-show="!rowform.$visible">
                                                    <button class="btn btn-info" ng-click="rowform.$show()">Edit</button>
                                                    <!--<button class="btn btn-danger" ng-click="removeUser($index)">del</button>-->
                                                </div>  
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tbody ng-show="isLoading">
                                        <tr>
                                            <td colspan="11" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="11" class="text-center">
                                                <div st-pagination="" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>