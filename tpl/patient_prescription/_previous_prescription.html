<table st-table="displayedCollection"  st-safe-src="rowCollection" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th style="width: 5%">
                <button class="btn btn-sm btn-default" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                    <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                    <i ng-if="allExpanded" class="fa fa-minus text"></i>
                </button>
            </th>
            <th>&nbsp;</th>
            <th>Prescription Date</th>
            <th>Consultant Name</th>
            <th>Next Visit</th>
            <th>No of days</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody ng-hide="isLoading">

        <tr ng-repeat-start="(pres_key, value) in displayedCollection">
            <td style="width: 5%">
                <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default">
                    <i ng-if="!expanded" class="fa fa-plus text"></i>
                    <i ng-if="expanded" class="fa fa-minus text"></i>
                </button>
            </td>
            <td>
                <label class="i-checks"> 
                    <input ng-model="row.selected" ng-true-value="'1'" ng-false-value="'0'" ng-checked="value.selected == '1'"  type="checkbox" name="checkall" class="prevprescheckbox prevprescheckbox_{{pres_key}}" ng-click="updateCheckbox(row, pres_key)"> 
                    <i></i> 
                </label>&nbsp; &nbsp;
            </td>
            <td>{{value.pres_date}}</td>
            <td>{{value.consultant_name}}</td>
            <td>{{value.next_visit}}</td>
            <td>{{value.number_of_days}}</td>
            <td>
                <button tooltip="Print Bill"  class="label bg-primary dk" ng-click="printPres(value.pres_id)">
                    <i class="fa fa-print"></i>
                </button>
            </td>
        </tr>
        <tr ng-repeat-end ng-show="expanded">
            <td></td>
            <td colspan="6">
                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>Product Name</th>
                            <th>Generic Name</th>
                            <th>Drug Name</th>
                            <th>Route</th>
                            <th>Frequency</th>
                            <th>No of days</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="(gKey, row) in value.items | orderBy: prescriptionitem" class="tr_prevprescheckbox tr_prevprescheckbox_{{pres_key}}">
                            <td>
                                <label class="i-checks"> 
                                    <input ng-model="row.selected" ng-true-value="'1'" ng-false-value="'0'" ng-checked="row.selected == '1'" class="prevprescheckbox prevprescheckbox_{{pres_key}}" id="prevpres_{{pres_key}}_{{gKey}}" type="checkbox" name="status" ng-click="moreOptions(pres_key, gKey, row)"> 
                                    <i></i> 
                                </label>
                            </td>
                            <td>{{ row.product_name}}</td>
                            <td>{{ row.generic_name}}</td>
                            <td>{{ row.drug_name}}</td>
                            <td>{{ row.route_name}}</td>
                            <td>{{ row.frequency_name}}</td>
                            <td>{{ row.number_of_days}}</td>
                            <td>{{ row.remarks || '-'}}</td>
                        </tr>
                    </tbody>
                </table>                            
            </td>
        </tr>
    </tbody>
    <tbody ng-show="isLoading">
        <tr>
            <td colspan="7" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
        </tr>
    </tbody>
</table>
<div id='print_previous_pres' ng-hide="true">
    <table class="invoice" align="center">
        <tbody>
            <tr>
                <td colspan="3" class="referenceId">
                    <table>
                        <tbody>
                            <tr>
                                <td width="48%"><b>#{{data2.pres_id}} / </b>{{today| date: "dd-MMMM-y" }}</td>
                                <td width="4%" align="center" class="logoTxt">
                                    <span>R</span>
                                    <span class="absoluteTxt">X</span>
                                </td>
                                <td width="48%" align="right">
                        <io-barcode code="{{patientObj.patient_global_int_code}}" type="CODE128B" options="barcodeOptions" width="125px" height="50px"></io-barcode>
                </td>
            </tr>
        </tbody> 
    </table>
</td>
</tr>
<tr>
    <td colspan="3" class="patientInfo">
        <table>
            <tbody>
                <tr>
                    <td width="5%" rowspan="3"><io-barcode code="{{patientObj.patient_global_int_code}}" type="CODE128B" options="barcodeOptions" style='height:50px;-ms-transform: rotate(90deg);-webkit-transform: rotate(270deg); transform: rotate(270deg);'></io-barcode></td>
    <td width="55%"><h2>{{patientObj.fullname}} / {{patientObj.patient_age}}</h2></td>
    <td width="40%" class="borderLeft">Issued by : <span class="lightColor">{{app.username}}</span></td>
</tr>
<tr>
    <td>{{patientObj.patient_global_int_code}} 
        <span ng-if="patientObj.patient_category" style="background-color: {{patientObj.patient_category_color}}" class="greenBg">
            {{patientObj.patient_category| uppercase}}
        </span>
    </td>
    <td class="borderLeft">Issued at : <span class="lightColor">{{app.org_name}}</span></td>
</tr>
<tr>
    <td>Consultant : <span class="lightColor">{{data2.consultant_name}}</span></td>
    <td class="borderLeft"><!--Collection at : <span class="lightColor">Ram Nagar</span>--></td>
</tr>
</tbody> 
</table>
</td>
</tr>
<tr>
    <td class="prescriptionInfo">
        <table>
            <thead>
                <tr>
                    <th><span>Medicine Name</span></th>
                    <th width="5%" class="txtCenter"><span><img src="{{IRISOrgUrl}}/img/sunrise.png" alt="Morning" /></span></th>
                    <th width="5%" class="txtCenter"><span><img src="{{IRISOrgUrl}}/img/brightness.png" alt="Afternoon" /></span></th>
                    <th width="5%" class="txtCenter"><span><img src="{{IRISOrgUrl}}/img/sun-shining.png" alt="Evening" /></span></th>
                    <th width="5%" class="txtCenter"><span><img src="{{IRISOrgUrl}}/img/moon.png" alt="Night" /></span></th>
                    <th width="10%" class="txtCenter"><span>Days</span></th>
                    <th><span>Remarks</span></th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="(gKey, row) in prescriptionItems2">
                    <td><p>{{row.product_name}}</p><i>(oxcarmaipine)</i></td>
                    <td class="txtCenter txtUpper" colspan="4" ng-if="row.freqType=='txt'">{{ getFrequencyExists(row.frequency_name, 0)}}</td>
                    
                    <td class="txtCenter" ng-if="row.freqType!='txt'">{{ getFrequencyExists(row.frequency_name, 0)}}</td>
                    <td class="txtCenter" ng-if="row.freqType!='txt'">{{ getFrequencyExists(row.frequency_name, 1)}}</td>
                    
                    <td class="txtCenter" ng-if="((row.freqType==3) && (row.freqType!='txt'))">-</td>
                    <td class="txtCenter" ng-if="((row.freqType!=3) && (row.freqType!='txt'))">{{ getFrequencyExists(row.frequency_name, 2)}}</td>
                    
                    <td class="txtCenter" ng-if="((row.freqType==3) && (row.freqType!='txt'))">{{ getFrequencyExists(row.frequency_name, 2)}}</td>
                    <td class="txtCenter" ng-if="((row.freqType!=3) && (row.freqType!='txt'))">{{ getFrequencyExists(row.frequency_name, 3)}}</td>
                    
                    
                    <td class="txtCenter">{{row.number_of_days}}</td>
                    <td>{{row.remarks||'-'}}</td>
                </tr>
            </tbody>
        </table>
    </td>
</tr> 
</tbody>
<!--<tfoot class="nextVisit">
    <tr>
        <td><p class="txtCenter">* Next Visit - {{data2.next_visit| date: "dd-MMMM-y" }}</p></td>
    </tr>
</tfoot>-->
</table>
<div>    
    <div style="position: absolute; bottom: 5px;">
        <p class="txtCenter" style="font-size: 25px;">* Next Visit - {{data2.next_visit| date: "dd-MMMM-y" }}</p>
    </div>
</div>
</div>
