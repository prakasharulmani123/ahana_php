<table class="table " st-safe-src="rowCollection" st-table="displayedCollection">
    <thead>
        <tr>
            <th style="width: 5%">
                <button class="btn btn-sm btn-default" type="button" ng-click="ctrl.expandAll(allExpanded = !allExpanded)">
                    <i ng-if="!allExpanded" class="fa fa-plus text"></i>
                    <i ng-if="allExpanded" class="fa fa-minus text"></i>
                </button>
            </th>
            <th>&nbsp;</th>
            <th>Prescription Date</th>
            <th>Branch Name</th>
            <th>Consultant Name</th>
            <th>Next Visit</th>
            <th style="width: 20%">Diagnosis</th>
            <th>No of days</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody ng-hide="isLoading">

        <tr ng-repeat-start="(pres_key, value) in displayedCollection">
            <td style="width: 5%">
                <button ng-click="expanded = !expanded" expand class="btn btn-sm btn-default hms-plus" >
                    <i ng-if="!expanded" class="fa fa-plus text"></i>
                    <i ng-if="expanded" class="fa fa-minus text"></i>
                </button>
            </td>
            <td>
                <label ng-if="value.tenant_id == app.logged_tenant_id" class="i-checks"> 
                    <input ng-model="row.selected" ng-true-value="'1'" ng-false-value="'0'" ng-checked="value.selected == '1'"  type="checkbox" name="checkall" class="prevprescheckbox prevprescheckbox_{{pres_key}}" ng-click="updateCheckbox(row, pres_key)"> 
                    <i></i> 
                </label>&nbsp; &nbsp;
            </td>
            <td>{{value.pres_date}}</td>
            <td>{{value.branch_name}}</td>
            <td>{{value.consultant_name}}</td>
            <td>{{value.next_visit| date: "dd-MMMM-y"}}</td>
            <td>{{value.diag_name}}</td>
            <td>{{value.number_of_days}}</td>
            <td>
                <button tooltip="Print Prescription"  class="label bg-primary dk" ng-click="printPres(value.pres_id)">
                    <i class="fa fa-print"></i>
                </button>
                <button tooltip="Edit Prescription"  class="label bg-dark dk" ng-click="prescriptionEdit(value)">
                    <i class="fa fa-pencil"></i>
                </button>
                <a ng-if="value.tenant_id == app.logged_tenant_id" data-button="patient.prescriptionDelete" check-access-custom title="Delete Prescription" ng-click="removeRow(value.pres_id)" class="label bg-dark dk">
                    <i class="fa fa-trash"></i>
                </a>
            </td>
        </tr>
        <tr ng-repeat-end ng-show="expanded">
            <td></td>
            <td colspan="7">
                <table class="table table-condensed table-bordered">
                    <thead>
                        <tr>
                            <th>&nbsp;</th>
                            <th>Product Name</th>
                            <th>Generic Name</th>
                            <th>Drug Name</th>
                            <th>Route</th>
                            <th>Frequency</th>
                            <th>No of days</th>
                            <th>AF / BF</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="(gKey, row) in value.items | orderBy: prescriptionitem" class="tr_prevprescheckbox tr_prevprescheckbox_{{pres_key}}">
                            <td>
                                <label ng-if="value.tenant_id == app.logged_tenant_id" class="i-checks"> 
                                    <input ng-model="row.selected" ng-true-value="'1'" ng-false-value="'0'" ng-checked="row.selected == '1'" class="prevprescheckbox prevprescheckbox_{{pres_key}}" id="prevpres_{{pres_key}}_{{gKey}}" type="checkbox" name="status" ng-click="moreOptions(pres_key, gKey, row)"> 
                                    <i></i> 
                                </label>
                            </td>
                            <td>{{ row.product_name}}</td>
                            <td>{{ row.generic_name}}</td>
                            <td>{{ row.drug_name}}</td>
                            <td>{{ row.route_name}}</td>
                            <td>{{ row.frequency_name}}</td>
                            <td>{{ row.number_of_days}}</td>
                            <td>{{ row.food_type == 'NA' ? '-' : row.food_type}}</td>
                            <td>{{ row.remarks || '-'}}</td>
                        </tr>
                    </tbody>
                </table>                            
            </td>
        </tr>
    </tbody>
    <tbody ng-show="isLoading">
        <tr>
            <td colspan="9" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
        </tr>
    </tbody>
    <tfoot>
        <tr>  
            <td align="center" colspan="9">  
                <div class="pull-right">  
                    <pagination total-items="totalCount" ng-change="pageChanged(pageIndex)" items-per-page="pageSizeSelected" direction-links="true" ng-model="pageIndex" max-size="maxSize" class="pagination" boundary-links="true" rotate="false" num-pages="numPages"></pagination>  
                </div>  
            </td>  
        </tr> 
    </tfoot>
</table>
<div id='print_previous_pres' ng-if="prescription_print_content"  ng-hide="true">
    <style parse-style>
        @media print
        {
            @page  {
                /*size: auto;*/
                margin-top: ' + prescription_print.PMT + 'mm;
                /*margin-top: 74mm;*/
                margin-bottom: 20mm;
            }

            #spacer {height: 3em;} /* height of footer + a little extra */
            #footer {
                position: fixed;
                bottom: 0;
            }
        }
        .prescription-table-head
        {

        }

        thead{
            display:table-header-group;/*repeat table headers on each page*/
        }
    </style>
    <div id="prescription_print_content_div"></div>
</div>