<div ng-controller="PrescriptionController">
    <div class="hbox hbox-auto-xs hbox-auto-sm">
        <div class="col" ng-show="prev_pre == '0'">
            <div class="bg-light lter b-b wrapper-md" style="width:100%;float:left; padding:10px; padding-bottom:0px; margin-bottom:15px;">
                <div class="col-sm-3 m-b-xs">  <h1 class="m-n h3">Prescription</h1> </div>
                <div class="col-sm-3 m-b-xs pull-right right">
                    <b> Encounter Id : </b> {{enc.selected.encounter_id}}
                </div>
            </div>
<!--            <div class="bg-light lter b-b wrapper-md prescrip-header">
                <div class="col-sm-2 m-b-xs">  <h1 class="m-n h3">Prescription</h1> </div>
                <div class="col-sm-2 m-b-xs right">  <b>Encounter Id:</b> </div>
                <div class="col-sm-3 m-b-xs">
                    <div class="btn-group btn-group-justified">
                        <ui-select ng-model="enc.selected" theme="bootstrap">
                            <ui-select-match placeholder="Select Encounter Id">{{$select.selected.encounter_id}}</ui-select-match>
                            <ui-select-choices repeat="item in encounters | filter: $select.search | orderBy: 'encounter_id' : true">
                                <div ng-bind-html="item.encounter_id | highlight: $select.search"></div>
                            </ui-select-choices>
                        </ui-select>
                        <br />
                    </div>
                </div>
                <div class="col-sm-3 m-b-xs">
                    <select class="form-control" ng-model="data.consultant_id" ng-options="doctor.user_id as doctor.fullname for doctor in doctors | orderBy: name" ng-change="getTimeOfAppointment();">
                        <option value="">Select Consultant</option>
                    </select>
                </div>
                <div class="col-sm-2 m-b-xs"> 
                    <button class="btn m-b-xs  btn-dark">  <i class="fa fa-times"></i> Clear </button>
                </div>
            </div>-->

            <div class="wrapper-md p-b">
                <div class="row">
                    <div class="col-sm-12">
                        <div ng-include="'tpl/blocks/alert.html'">
                            {% include 'tpl/blocks/alert.html' %}
                        </div>
                        <div class="panel panel-default"> 
                            <div class="row wrapper pb-sm">
                                <div class="col-sm-8 m-b-xs " style="width:680px;" > 

                                    <div class="input-group">
                                        <input type="text" 
                                               class="form-control prescription_search_input" 
                                               placeholder="Enter Your Prescription" 
                                               ng-model='prescription'
                                               />
                                        <ul class="search-patientcont-header" id='prescriptioncont-header' ng-show="prescription_lists.length > 0">
                                            <li ng-repeat="prescription_list in prescription_lists">
                                                <div class="row"> 
                                                    <div class="col-xs-12 col-sm-2 col-md-1"> 
                                                        <div class="row ng-binding">
                                                            &nbsp;
                                                        </div>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-10 col-md-11"> 
                                                        <div class="row ng-binding">
                                                            <a ng-bind-html="prescription_list.prescription | highlight:prescription" href="javascript:void(0)" class="ng-binding" ng-click="addGlobalSearch(prescription_list)"></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        </ul>

                                        <div class="input-group-btn dropdown" id="search-form-div">
                                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>
                                            <div class="dropdown-menu pull-right prescrip-dropdown {{search_form}}" ng-init="initForm()" id="search-form">
                                                <form name="searchForm" class="form-horizontal form-validation" novalidate="">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading font-bold"> <i class="fa fa-medkit"></i> Search & Add</div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <label> Drug Class</label>
                                                                    <input autocomplete="off"
                                                                           placeholder="Drug Class"
                                                                           type="text"
                                                                           class="form-control"
                                                                           ng-model="addData.drug_class"
                                                                           typeahead-editable="false"
                                                                           typeahead="drug as drug.drug_name for drug in drugs | filter:$viewValue"
                                                                           typeahead-on-select="getGeneric($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Generic </label>
                                                                    <input autocomplete="off"
                                                                           placeholder="Generic"
                                                                           type="text"
                                                                           class="form-control"
                                                                           ng-model="addData.generic"
                                                                           typeahead-editable="false"
                                                                           typeahead="generic as generic.generic_name for generic in generics | filter:$viewValue"
                                                                           typeahead-on-select="getProduct($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Product</label>
                                                                    <input autocomplete="off"
                                                                           placeholder="Product"
                                                                           type="text"
                                                                           class="form-control"
                                                                           ng-model="addData.product"
                                                                           typeahead-editable="false"
                                                                           typeahead="product as product.full_name for product in products | filter:$viewValue"
                                                                           />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Freq</label>
                                                                    <!--Ui-mask & Typeahead Not working -->
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           name="masked" 
                                                                           ui-mask="9-9-9" 
                                                                           ng-model="addData.frequency" 
                                                                           model-view-value="true" 
                                                                           class="form-control m-b"
                                                                           typeahead="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"
                                                                           required>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Route </label>
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           ng-model="addData.route" 
                                                                           class="form-control m-b" 
                                                                           typeahead="route.route_name for route in routes | filter:$viewValue"
                                                                           required>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label>No.of.Days </label>
                                                                    <input autocomplete="off" type="text" ng-model="addData.number_of_days" class="form-control m-b" number-mask="" required>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> </label>
                                                                    <br/>
                                                                    <button class="btn m-b-xs  btn-success save-btn" ng-click="addForm()"><i class="fa fa-plus"></i> Add</button>
                                                                    &nbsp;
                                                                    <button class="btn m-b-xs  btn-dark" ng-click="addData = {}"> <i class="fa fa-repeat"></i> Reset</button>
                                                                    &nbsp; </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-3 m-b-xs">
                                    <select class="form-control" ng-model="data.consultant_id" ng-options="doctor.user_id as doctor.fullname for doctor in doctors | orderBy: name" ng-change="getTimeOfAppointment();">
                                        <option value="">Select Consultant</option>
                                    </select>
                                </div>
                                <div class="col-sm-2 m-b-xs"> 
                                    <button class="btn m-b-xs  btn-dark">  <i class="fa fa-times"></i> Clear </button>
                                </div>
                            </div>
                            <form editable-form name="tableform" name="prescForm" class="form-horizontal form-validation" novalidate="" shown="true" onaftersave="saveForm()">
                                <div class="table-responsive in-patient-table">
                                    <div class="wrapper-md p-b">
                                        <div  class="row" style="height:220px;overflow-y: auto;" >
                                            <table class="table table-striped b-t b-light" id="prescription_item">
                                                <thead>
                                                    <tr>
                                                        <th width="60" align="left">Favorite </th>
                                                        <th width="251" align="left">Product </th>
                                                        <th width="45" align="left">Route </th>
                                                        <th width="43" align="left">Freq</th>
                                                        <th width="70" align="center">No.of Days </th>
                                                        <th width="70" align="center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="(key, item) in data.prescriptionItems">
                                                        <td>
                                                            <a href ui-toggle-class class="{{item.is_favourite ? 'active' : ''}}">
                                                                <i class="fa fa-star-o text-muted text" ng-click="updateFavourite(1, item.product_id)"></i>
                                                                <i class="fa fa-star text-info text-active" ng-click="updateFavourite(0, item.product_id)"></i> 
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span editable-text="item.product_name"
                                                                  e-class="form-control"
                                                                  e-name="product_name" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-typeahead-editable="false"
                                                                  e-typeahead="product as product.full_name for product in products | filter:$viewValue"
                                                                  e-autocomplete="off"
                                                                  e-placeholder="Product"
                                                                  e-required>
                                                                {{ item.product_name || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span editable-text="item.route"
                                                                  e-class="form-control m-b"
                                                                  e-name="route" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-typeahead="route.route_name for route in routes | filter:$viewValue"
                                                                  e-autocomplete="off"
                                                                  e-placeholder="Route"
                                                                  e-id="route"
                                                                  e-required>
                                                                {{ item.route || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span editable-text="item.frequency"
                                                                  e-class="form-control m-b"
                                                                  e-name="masked" 
                                                                  e-ui-mask="9-9-9"
                                                                  e-model-view-value="true"
                                                                  e-form="tableform" 
                                                                  e-typeahead="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"
                                                                  e-autocomplete="off"
                                                                  e-id="frequency"
                                                                  e-required>
                                                                {{ item.frequency || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.number_of_days"
                                                                  e-class="form-control"
                                                                  e-name="number_of_days" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-autocomplete="off"
                                                                  e-id="number_of_days"
                                                                  e-required>
                                                                {{ item.number_of_days || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td align="left">
                                                            <!--<button class="label bg-dark" ng-click="tableform.$show()"><i class="fa fa-pencil"></i></button>-->
                                                            <button type="button" class="label bg-info" ng-click="removeItem(item)"><i class=" fa fa-trash"></i></button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <footer class="panel-footer">
                                    <div class="row">
                                        <div class="col-sm-2 "> <i class="fa fa-calendar"></i> <b> Next Vist </b> </div>
                                        <div class="col-sm-1 ">
                                            <label> Date </label>
                                        </div>
                                        <div class="col-sm-3">
                                            <div class="row">
                                                <input type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="data.next_visit" is-open="opened" datepicker-options="dateOptions" close-text="Close"  min-date="minDate" ng-click="open($event)" prevent-enter="true" ng-change="setDayEmpty();
                                                                getDays();"/>
                                            </div>
                                        </div>
                                        <div class="col-sm-1 ">
                                            <label> No.of.Days </label>
                                        </div>
                                        <div class="col-sm-2 ">
                                            <input autocomplete="off" type="text" ng-model="data.number_of_days" class="form-control m-b" number-mask="" ng-change="setDateEmpty();
                                                            getVisit();" required>
                                        </div>
                                        <div class="col-sm-3">
                                            <button type="submit" class="btn m-b-xs  btn-success save-btn"> <i class="fa fa-check"></i> Save </button>
                                            &nbsp;
                                            <button type="button" class="btn m-b-xs  btn-dark"> <i class="fa fa-print"></i> Print </button>
                                            &nbsp; </div>
                                    </div>
                                </footer>
                            </form>

                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!--<div class="col" ng-if="app.settings.patientSideMenu == true">-->
        <div class="col" ng-show="prev_pre == '1'">
            <div ng-include="'tpl/patient_prescription/_previous_prescription.html'">
                {% include 'tpl/patient_prescription/_previous_prescription.html' %}
            </div>
        </div>

        <div class="col w-sm pres-div bg-light dk b-r bg-auto" style="width:110px;">
            <div class="wrapper pres-right hidden-sm hidden-xs" id="email-menu">
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <li ng-repeat="fold in folds" ui-sref-active="active">
                        <a ui-sref="app.mail.list({fold:fold.filter})">
                            {{fold.name}}
                        </a>
                    </li>
                </ul>
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <li><a href="javascript:void(0)" class="active4" ng-click="prescriptionStauts('1')"><i class="fa fa-medkit"></i> <br/>Prescription</a></li>
                    <li><a href="javascript:void(0)" ng-click="prescriptionStauts('0')"><i class="fa fa-history"></i> <br/>Prev-Prescr</a></li>
                    <li><a href="javascript:void(0)"><i class="fa fa-file-text"></i> <br/>Results </a></li>
                    <li><a href="javascript:void(0)" class="sb-open-right" data-target="#fav"><i class="fa fa-heart"></i> <br/> Favorites</a></li>
                    <li><a href="javascript:void(0)" class="sb-open-right" data-target="#notes" ng-click="seen_notes()"><i class="fa fa-pencil"></i> <br/>  <span class="label label-danger" ng-show="unseen_notes_count > 0">{{unseen_notes_count}}</span> Notes</a></li>
                    <li><a href="javascript:void(0)" class="sb-open-right" data-target="#vitals" ng-click="seen_vitals()"> <i class="fa fa-heartbeat"></i> <br/>  <span class="label label-danger" ng-show="unseen_vitals_count > 0">{{unseen_vitals_count}}</span> Vitals</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#search-form').on('click', function (e) {
            e.stopPropagation();
        });
        if ($.isFunction($.slidebars)) {
            slidebar();
        } else {
            $.getScript("js/slidebars.js", function (data, textStatus, jqxhr) {
                slidebar();
            });
        }
    });
    function slidebar() {
        $.slidebars({
            scrollLock: true
        });
    }
</script>


