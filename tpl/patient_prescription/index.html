<div ng-controller="PrescriptionController">
    <div class="hbox hbox-auto-xs hbox-auto-sm">
        <!-- CURRENT -->
        <div class="col" ng-show="pres_status == 'current'">
            <div class="bg-light lter b-b wrapper-md" style="width:100%;float:left; padding:10px; padding-bottom:0px; margin-bottom:15px;">
                <div class="col-sm-3 m-b-xs">  <h1 class="m-n h3">Prescription</h1> </div>
                <div class="col-sm-3 m-b-xs pull-right right" ng-if="all_encounters.length > 1">
                    <b> Encounter Id : </b>&nbsp;&nbsp;&nbsp;
                    <select style="width: 50%" class="form-control pull-right" ng-model="data.encounter_id" ng-options="all_encounter.encounter_id as all_encounter.encounter_id for all_encounter in all_encounters| orderBy: encounter_id">
                    </select>
                </div>
                <div class="col-sm-3 m-b-xs pull-right right" ng-if="all_encounters.length == 1">
                    <b> Encounter Id : </b> {{enc.selected.encounter_id}}
                </div>
            </div>
            <div class="wrapper-md p-b">
                <div class="row">
                    <div class="col-sm-12">
                        <div ng-include="'tpl/blocks/alert.html'">
                            {% include 'tpl/blocks/alert.html' %}
                        </div>
                        <div class="panel panel-default"> 
                            <div class="row wrapper pb-sm pb-0">
                                <div class="col-sm-8" style="width:680px;" > 
                                    <div class="input-group">
                                        <input type="text"
                                               id="prescription_global_search"
                                               class="form-control prescription_search_input" 
                                               placeholder="Enter Your Prescription" 
                                               ng-model='prescription'
                                               />
                                        <div class="patient-search-result" ng-if="prescription != '' && prescription_lists" >
                                            <ul class="search-patientcont-header" id='prescriptioncont-header' ng-show="prescription_lists.length > 0">
                                                <li ng-repeat="(key, prescription_list) in prescription_lists" class="{{prescription_list.selected}}" ng-click="addGlobalSearch(prescription_list)">
                                                    <a data-key="{{key}}" ng-bind-html="prescription_list.prescription | highlight:prescription" href="javascript:void(0)" class="ng-binding"></a>
                                                </li>
                                            </ul>
                                        </div>

                                        <!-- Advance Search -->
                                        <div class="input-group-btn dropdown" id="search-form-div">
                                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                <span class="caret"></span>
                                            </button>

                                            <div class="dropdown-menu pull-right prescrip-dropdown" ng-init="initForm()" id="search-form">
                                                <form id="advanceSearchForm" name="searchForm" class="form-horizontal form-validation" novalidate="">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading font-bold"> <i class="fa fa-medkit"></i> Search & Add</div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <label>Drug Class</label>
                                                                    <input autocomplete="off"
                                                                           placeholder="Drug Class"
                                                                           type="text"
                                                                           class="form-control"
                                                                           name = "DrugClass"
                                                                           ng-model="addData.drug_class"
                                                                           ng-change = "watchDrug(true, this)"
                                                                           typeahead-editable="true"
                                                                           typeahead="drug as drug.drug_name for drug in drugs | filter:$viewValue"
                                                                           typeahead-on-select="getGeneric($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Generic </label>
                                                                    <select ng-show="generics.length > 0" class="form-control" name="Generic" ng-model="addData.generic" ng-options="generic as generic.generic_name for generic in generics| filter:$viewValue" data-ng-change="getProduct(false, null, null)">
                                                                        <option value="">Select Generic</option>
                                                                    </select>
                                                                    <input autocomplete="off"
                                                                           placeholder="Generic"
                                                                           type="text"
                                                                           class="form-control"
                                                                           ng-model="addData.generic"
                                                                           ng-hide="generics.length > 0"
                                                                           typeahead-editable="false"
                                                                           typeahead-min-length='2'
                                                                           typeahead="generic as generic.generic_name for generic in allgenerics | filter:$viewValue"
                                                                           typeahead-on-select="getDrugProduct($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Product</label>
                                                                    <select class="form-control" name="Product" ng-model="addData.product" ng-options="product as product.full_name for product in products| filter:$viewValue" data-ng-change="setGeneric();
                                                                                        getRoutes(false, null, null)">
                                                                        <option value="">Select Product</option>
                                                                    </select>
                                                                    <!--                                                                    <input autocomplete="off"
                                                                                                                                               placeholder="Product"
                                                                                                                                               type="text"
                                                                                                                                               class="form-control"
                                                                                                                                               ng-model="addData.product"
                                                                                                                                               typeahead-editable="false"
                                                                                                                                               typeahead="product as product.full_name for product in products | filter:$viewValue"
                                                                                                                                               />-->
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Freq</label>
                                                                    <!--Ui-mask & Typeahead Not working -->
                                                                    <!--typeahead="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"-->
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           name="masked" 
                                                                           ui-mask="9-9-9-9" 
                                                                           ng-model="addData.frequency" 
                                                                           model-view-value="true" 
                                                                           class="form-control m-b"
                                                                           required>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Route </label>
                                                                    <select class="form-control" name="Route" ng-model="addData.route" ng-options="route as route.route_name for route in routes| filter:$viewValue">
                                                                        <option value="">Select Route</option>
                                                                    </select>
                                                                    <!--                                                                    <input autocomplete="off" 
                                                                                                                                               type="text" 
                                                                                                                                               ng-model="addData.route" 
                                                                                                                                               class="form-control m-b" 
                                                                                                                                               typeahead="route.route_name for route in routes | filter:$viewValue"
                                                                                                                                               required>-->
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label>No.of.Days </label>
                                                                    <input autocomplete="off" type="text" ng-model="addData.number_of_days" class="form-control m-b" number-mask="">
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> </label>
                                                                    <br/>
                                                                    <button class="btn m-b-xs  btn-success save-btn" ng-click="addForm()"><i class="fa fa-plus"></i> Add</button>
                                                                    &nbsp;
                                                                    <button class="btn m-b-xs  btn-dark" ng-click="reset()"> <i class="fa fa-repeat"></i> Reset</button>
                                                                    &nbsp; </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <select class="form-control" ng-model="data.consultant_id" ng-options="doctor.user_id as doctor.fullname for doctor in doctors| orderBy: name">
                                        <option value="">Select Consultant</option>
                                    </select>
                                </div>
                                <div class="col-sm-1"> 
                                    <button class="btn m-b-xs  btn-dark" ng-click="clearPrescription()">  
                                        <i class="fa fa-times"></i> Clear 
                                    </button>
                                </div>
                            </div>
                            <form editable-form name="tableform" name="prescForm" class="form-horizontal form-validation" novalidate="" shown="true" onaftersave="saveForm()">
                                <div class="table-responsive">
                                    <div class="wrapper p-b">
                                        <div  style="height:220px;overflow-y: auto;" >
                                            <table class="table table-striped b-t b-light" id="prescription_item">
                                                <thead>
                                                    <tr>
                                                        <th width="30" align="left">Fav</th>
                                                        <th width="150" align="left">Product</th>
                                                        <th width="65" align="left">Route</th>
                                                        <th width="100" align="left">Freq</th>
                                                        <th width="70" align="center">No.of Days</th>
                                                        <th width="50" align="center">Cost</th>
                                                        <th width="45" align="center">Remarks</th>
                                                        <th width="35" align="center">Total</th>
                                                        <th width="40" align="center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody ng-hide="isLoading">
                                                    <tr class="out_of_stock" ng-repeat="item in data.prescriptionItems| filter:lesserThan('available_quantity', 0)" ng-init="key = item.item_key">
                                                        <td>
                                                            <a href ui-toggle-class class="{{item.is_favourite ? 'active' : ''}}">
                                                                <i class="fa fa-star-o text-muted text" ng-click="updateFavourite(1, item.product_id)"></i>
                                                                <i class="fa fa-star text-info text-active" ng-click="updateFavourite(0, item.product_id)"></i> 
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.product_name"
                                                                  e-tabindex="2{{key}}1"
                                                                  e-class="form-control"
                                                                  e-name="product_name" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)" 
                                                                  e-ng-change="setProductId($data, key)" 
                                                                  e-ng-options="product.full_name as product.full_name for product in all_products | filter:$viewValue | filter:{generic_id : item.generic_id}" 
                                                                  e-required>
                                                                {{ showProduct(item)}}
                                                            </span>
                                                            <!--                                                            <span editable-text="item.product_name"
                                                                                                                              e-class="form-control"
                                                                                                                              e-name="product_name" 
                                                                                                                              e-form="tableform" 
                                                                                                                              onbeforesave="checkInput($data)"
                                                                                                                              e-typeahead-editable="false"
                                                                                                                              e-typeahead="product as product.full_name for product in products | filter:$viewValue"
                                                                                                                              e-autocomplete="off"
                                                                                                                              e-placeholder="Product"
                                                                                                                              e-required>
                                                                                                                            {{ item.product_name || 'empty' }}
                                                                                                                        </span>-->
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.route" 
                                                                  e-tabindex="2{{key}}2"
                                                                  e-class="form-control m-b"
                                                                  e-name="route" 
                                                                  e-form="tableform" 
                                                                  e-ng-change="setRouteId($data, key)" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-id="route"
                                                                  e-ng-options="route.route_name as route.route_name for route in item.description_routes | filter:$viewValue" 
                                                                  e-required>
                                                                {{ showRoute(item)}}
                                                            </span>
                                                            <!--                                                            <span editable-text="item.route"
                                                                                                                              e-class="form-control m-b"
                                                                                                                              e-name="route" 
                                                                                                                              e-form="tableform" 
                                                                                                                              onbeforesave="checkInput($data)"
                                                                                                                              e-typeahead="route.route_name for route in item.description_routes | filter:$viewValue"
                                                                                                                              e-autocomplete="off"
                                                                                                                              e-placeholder="Route"
                                                                                                                              e-id="route"
                                                                                                                              e-required>
                                                                                                                            {{ item.route || 'empty' }}
                                                                                                                        </span>-->
                                                        </td>
                                                        <td>
                                                            <!--                                                            <span editable-select="item.frequency"
                                                                                                                              e-class="form-control m-b"
                                                                                                                              e-name="masked" 
                                                                                                                              e-form="tableform" 
                                                                                                                              e-ng-options="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"
                                                                                                                              e-required>
                                                                                                                            {{ item.frequency || 'empty' }}
                                                                                                                        </span>-->

                                                            <!--e-typeahead="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"-->
                                                            <div id="freq_{{key}}_3" class="freq_div_{{key}} hide" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="2{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_3"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{key}}_4" class="freq_div_{{key}}" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="2{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_4"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{key}}_5" class="freq_div_{{key}} hide" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="2{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_5"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div style="width: 20px; float:left">
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}}" id="change_mask_{{key}}_3" ng-click="changeFreqMask(key, 3)">3</a>
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}} hide" id="change_mask_{{key}}_4" ng-click="changeFreqMask(key, 4)">4</a>
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}}" id="change_mask_{{key}}_5" ng-click="changeFreqMask(key, 5)">5</a>
                                                            </div>
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.number_of_days"
                                                                  e-tabindex="2{{key}}4"
                                                                  e-class="form-control"
                                                                  e-name="number_of_days" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-autocomplete="off"
                                                                  e-id="number_of_days"
                                                                  e-ng-change="numberDaysChange($data, item, key)"
                                                                  e-number-mask=""
                                                                  e-required>
                                                                {{ item.number_of_days || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            {{ item.price}}
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.remarks"
                                                                  e-tabindex="2{{key}}5"
                                                                  e-class="form-control"
                                                                  e-name="remarks" 
                                                                  e-form="tableform" 
                                                                  e-autocomplete="off"
                                                                  e-id="remarks"
                                                                  e-required>
                                                                {{ item.remarks || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            {{ item.total | number:2}}
                                                        </td>
                                                        <td align="left">
                                                            <!--<button class="label bg-dark" ng-click="tableform.$show()"><i class="fa fa-pencil"></i></button>-->
                                                            <button type="button" class="label bg-info" ng-click="removeItem(item)"><i class=" fa fa-trash"></i></button>
                                                        </td>
                                                    </tr>
                                                    <tr ng-repeat="item in data.prescriptionItems| filter:greaterThan('available_quantity', 0)" ng-init="key = item.item_key">
                                                        <td>
                                                            <a href ui-toggle-class class="{{item.is_favourite ? 'active' : ''}}">
                                                                <i class="fa fa-star-o text-muted text" ng-click="updateFavourite(1, item.product_id)"></i>
                                                                <i class="fa fa-star text-info text-active" ng-click="updateFavourite(0, item.product_id)"></i> 
                                                            </a>
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.product_name"
                                                                  e-tabindex="1{{key}}1"
                                                                  e-class="form-control"
                                                                  e-name="product_name" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)" 
                                                                  e-ng-change="setProductId($data, key)" 
                                                                  e-ng-options="product.full_name as product.full_name for product in all_products | filter:$viewValue | filter:{generic_id : item.generic_id}" 
                                                                  e-required>
                                                                {{ showProduct(item)}}
                                                            </span>
                                                            <!--                                                            <span editable-text="item.product_name"
                                                                                                                              e-class="form-control"
                                                                                                                              e-name="product_name" 
                                                                                                                              e-form="tableform" 
                                                                                                                              onbeforesave="checkInput($data)"
                                                                                                                              e-typeahead-editable="false"
                                                                                                                              e-typeahead="product as product.full_name for product in products | filter:$viewValue"
                                                                                                                              e-autocomplete="off"
                                                                                                                              e-placeholder="Product"
                                                                                                                              e-required>
                                                                                                                            {{ item.product_name || 'empty' }}
                                                                                                                        </span>-->
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.route" 
                                                                  e-tabindex="1{{key}}2"
                                                                  e-class="form-control m-b"
                                                                  e-name="route" 
                                                                  e-form="tableform" 
                                                                  e-ng-change="setRouteId($data, key)" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-id="route"
                                                                  e-ng-options="route.route_name as route.route_name for route in item.description_routes | filter:$viewValue" 
                                                                  e-required>
                                                                {{ showRoute(item)}}
                                                            </span>
                                                            <!--                                                            <span editable-text="item.route"
                                                                                                                              e-class="form-control m-b"
                                                                                                                              e-name="route" 
                                                                                                                              e-form="tableform" 
                                                                                                                              onbeforesave="checkInput($data)"
                                                                                                                              e-typeahead="route.route_name for route in item.description_routes | filter:$viewValue"
                                                                                                                              e-autocomplete="off"
                                                                                                                              e-placeholder="Route"
                                                                                                                              e-id="route"
                                                                                                                              e-required>
                                                                                                                            {{ item.route || 'empty' }}
                                                                                                                        </span>-->
                                                        </td>
                                                        <td>
                                                            <!--                                                            <span editable-select="item.frequency"
                                                                                                                              e-class="form-control m-b"
                                                                                                                              e-name="masked" 
                                                                                                                              e-form="tableform" 
                                                                                                                              e-ng-options="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"
                                                                                                                              e-required>
                                                                                                                            {{ item.frequency || 'empty' }}
                                                                                                                        </span>-->

                                                            <!--e-typeahead="frequency as frequency.freq_name for frequency in frequencies | filter:$viewValue"-->
                                                            <div id="freq_{{key}}_3" class="freq_div_{{key}} hide" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="1{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_3"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{key}}_4" class="freq_div_{{key}}" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="1{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_4"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{key}}_5" class="freq_div_{{key}} hide" style="width: 85%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-tabindex="1{{key}}3"
                                                                      e-class="form-control m-b frequency_{{key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-ui-mask="9-9-9-9-9"
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{key}}_5"
                                                                      e-ng-change="freqChange($data, item, key)"
                                                                      >
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div style="width: 20px; float:left">
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}}" id="change_mask_{{key}}_3" ng-click="changeFreqMask(key, 3)">3</a>
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}} hide" id="change_mask_{{key}}_4" ng-click="changeFreqMask(key, 4)">4</a>
                                                                <a href="javascript:void(0)" class="badge freq btn-dark change_mask_{{key}}" id="change_mask_{{key}}_5" ng-click="changeFreqMask(key, 5)">5</a>
                                                            </div>
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.number_of_days"
                                                                  e-tabindex="1{{key}}4"
                                                                  e-class="form-control"
                                                                  e-name="number_of_days" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-autocomplete="off"
                                                                  e-id="number_of_days"
                                                                  e-ng-change="numberDaysChange($data, item, key)"
                                                                  e-number-mask=""
                                                                  e-required>
                                                                {{ item.number_of_days || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            {{ item.price}}
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.remarks"
                                                                  e-tabindex="1{{key}}5"
                                                                  e-class="form-control"
                                                                  e-name="remarks" 
                                                                  e-form="tableform" 
                                                                  e-autocomplete="off"
                                                                  e-id="remarks"
                                                                  e-required>
                                                                {{ item.remarks || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            {{ item.total | number:2}}
                                                        </td>
                                                        <td align="left">
                                                            <!--<button class="label bg-dark" ng-click="tableform.$show()"><i class="fa fa-pencil"></i></button>-->
                                                            <button type="button" class="label bg-info" ng-click="removeItem(item)"><i class=" fa fa-trash"></i></button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                                <tbody ng-show="isLoading">
                                                    <tr>
                                                        <td colspan="9" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>                                     
                                    </div>
                                </div>
                                <footer class="panel-footer">
                                    <div class="form-horizontal">
                                        <div class="form-inline">
                                            <div class="form-group">
                                                <label for="exampleInputEmail2"><i class="fa fa-calendar"></i> <b> Next Vist </b></label>
                                                <input type="text" class="form-control multimonthdatepicker" ng-model="data.next_visit" ng-click="open($event)" prevent-enter="true" ng-change="setDayEmpty();
                                                                getDays();"/>    
                                            </div>

                                            <div class="form-group">
                                                <label for="exampleInputEmail2">
                                                    <i class="fa fa-calendar-o"></i> <b> No.of.Days </b>
                                                </label>
                                                <input autocomplete="off" type="text" ng-model="data.number_of_days" class="form-control m-b" number-mask="" ng-change="setDateEmpty();
                                                                getVisit();">    
                                            </div>

                                            <div class="form-group">
                                                <label for="exampleInputEmail2">
                                                    <i class="fa fa-rupee"></i> <b> Total Price</b>
                                                </label>
                                                <input type="text" class="form-control m-b" number-mask="" disabled="true" value="{{ priceTotal() | number:2}} "/>    
                                            </div>
                                            <button class="btn btn-success save-btn-1" ng-click="getBtnId('save')"> <i class="fa fa-check"></i> Save </button>
                                            <button class="btn btn-dark save-print" ng-click="getBtnId('print')"> <i class="fa fa-print"></i> Save & Print </button>
                                        </div>
                                    </div>
                                </footer>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--<div class="col" ng-if="app.settings.patientSideMenu == true">-->
        <!-- Prev presc -->
        <div class="col" ng-show="pres_status == 'prev'">
            <div class="bg-light lter b-b wrapper-md">
                <h1 class="m-n h3">Previous Prescription</h1>
            </div>
            <div class="wrapper-md p-b">
                <div class="panel panel-default">
                    <div class="row wrapper pb-sm">
                        <div class="col-sm-9">
                            <span ng-show="previousPresSelected > 0">
                                <button ng-click="addToCurrentPrescription()" class="btn btn-sm btn-primary">
                                    <i class="fa fa-retweet"></i> Add to current prescription
                                </button>
                            </span>
                        </div>
                        <div class="col-sm-3">
                            <div class="row">   
                                <div class="col-sm-9">
                                    <div class="input-group">
                                        <input placeholder="Filter by date" prevent-enter type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="filterdate" is-open="opened" datepicker-options="dateOptions" close-text="Close" max-date="maxDate" date-disabled="disabled(date, 'day')" ng-change="loadPrevPrescriptionsList(filterdate);"/>
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <button ng-click="filterdate = '';
                                                loadPrevPrescriptionsList()" class="btn m-b-xs  btn-dark">  
                                        <i class="fa fa-times"></i> 
                                    </button>
                                </div> 
                            </div>
                        </div>    
                    </div>
                    <div ng-include="'tpl/patient_prescription/_previous_prescription.html'">
                        {% include 'tpl/patient_prescription/_previous_prescription.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Nav -->
        <div class="col w-sm pres-div bg-light dk b-r bg-auto" style="width:110px;">
            <div class="wrapper pres-right hidden-sm hidden-xs" id="email-menu">
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <li ng-repeat="fold in folds" ui-sref-active="active">
                        <a ui-sref="app.mail.list({fold:fold.filter})">
                            {{fold.name}}
                        </a>
                    </li>
                </ul>
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <!--                    class="active4"-->
                    <li><a id="current_prescription" href="javascript:void(0)" ng-click="pres_status = 'current'"><i class="fa fa-medkit"></i> <br/>Prescription</a></li>
                    <li>
                        <a href="javascript:void(0)" class="sb-open-right" data-target="#vitals" ng-click="seen_vitals()"> 
                            <i class="fa fa-heartbeat"></i>  
                            <span class="badge badge-sm up bg-danger pull-right-xs" ng-show="unseen_vitals_count > 0">
                                {{unseen_vitals_count}}
                            </span>
                            <br>
                            Vitals
                        </a>
                    </li>
                    <li><a href="javascript:void(0)"><i class="fa fa-file-text"></i> <br/>Results </a></li>
                    <li>
                        <a href="javascript:void(0)" class="sb-open-right" data-target="#notes" ng-click="seen_notes()">
                            <i class="fa fa-pencil"></i>
                            <span class="badge badge-sm up bg-danger pull-right-xs" ng-show="unseen_notes_count > 0">
                                {{unseen_notes_count}}
                            </span> 
                            <br>
                            Notes
                        </a>
                    </li>
                    <li><a href="javascript:void(0)" class="sb-open-right" data-target="#fav"><i class="fa fa-heart"></i> <br/> Favorites</a></li>
                    <li><a id="prev_prescription" href="javascript:void(0)" ng-click="pres_status = 'prev'"><i class="fa fa-history"></i> <br/>Prev-Prescr</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!--Print Bill-->
    <div id="Getprintval" ng-hide="true">
        <div class="priscription-cont">
            <main>
                <table cellspacing="0" cellpadding="0" border="0" width="100%">
                    <thead>
                        <tr>
                            <td colspan="2" align="left">
                                <span style="font-size: 20px;font-weight: bold; padding: 24px;">+</span>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="2" align="right"><io-barcode code="{{patientObj.patient_global_int_code}}" type="{{ type}}" options="barcodeOptions"></io-barcode></td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td><h2> {{patientObj.fullname}} <span>({{patientObj.patient_age}}yrs)</span></h2> </td>
                                    <td align="right"><b>Date :</b>{{ prescriptionItems2[0].presc_date}}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2"> 
                            <div style="width:100%; min-height:500px;"> 
                                <table width="100%" border="0" cellspacing="0" cellpadding="0" >
                                    <tr>
                                        <th align="left" style="width:280px;"><strong>Description</strong></th>
                                        <th align="center"><img src="img/weather1.png" width="20" height="25" alt="" /></th>
                                        <th align="center"><img src="img/weather2.png" width="20" height="25" alt="" /></th>
                                        <th align="center"><img src="img/weather3.png" width="20" height="25" alt="" /></th>
                                        <th align="center"><img src="img/weather4.png" width="20" height="25" alt="" /></th>
                                        <th align="center">Remarks</th>
                                    </tr>
                                    <tr ng-repeat="(key, item) in prescriptionItems2">
                                        <td>{{ item.product_name || 'empty' }} <br/> <span> ({{ item.number_of_days || 'empty' }} days)</span> </td>
                                        <td align="center">{{ getFrequencyExists(item.frequency, 0)}}</td>
                                        <td align="center">{{ getFrequencyExists(item.frequency, 1)}}</td>
                                        <td align="center">{{ getFrequencyExists(item.frequency, 2)}}</td>
                                        <td align="center">{{ getFrequencyExists(item.frequency, 3)}}</td>
                                        <td align="center">{{ item.remarks || '-'}}</td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2">
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td>Next Review : <b> {{data2.next_visit}}</b></td>
                                    <td align="right">{{consultant_name}}</td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td style="border-top:#2e2e2e solid 1px;">Printed Date : {{current_time}}</td>
                        <td align="center" style="font-size:12px; border-top:#2e2e2e solid 1px;">{{app.org_appfull_address}} Ph :{{app.org_mobile}}</td>
                        <td style="border-top:#2e2e2e solid 1px;">&nbsp;</td>
                    </tr>
                    </tbody>
                </table>
            </main>
        </div>

    </div>     
</div>

<script>
    $(document).ready(function () {
        $('#search-form').on('click', function (e) {
            e.stopPropagation();
        });
        $.getScript("js/slidebars.js", function (data, textStatus, jqxhr) {
            slidebar();
        });
//        prescription right navigation
        $('.expand-notes').click(function (e) {
            $('#makeit-full').toggleClass('fullscreen');
            $('.note-full').toggleClass('fullscreen');
            var div_width = '-' + $('#makeit-full').css('width');
            $('#sb-site').css('transform', 'translate(' + div_width + ')');
            $('#sb-site').css('transition', 'none');
        });
        $(".multimonthdatepicker").datepicker({
            numberOfMonths: 2,
            showButtonPanel: true,
            dateFormat: 'yy-mm-dd',
            minDate: 0
        });
    });
    function slidebar() {
        $.slidebars({
            scrollLock: true
        });
    }
</script>
