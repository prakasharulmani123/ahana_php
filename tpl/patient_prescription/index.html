<div ng-controller="PrescriptionController">
    <div class="hbox hbox-auto-xs hbox-auto-sm">
        <!-- CURRENT -->
        <div class="col" ng-show="pres_status == 'current'">
            <div class="bg-light lter b-b wrapper-md presc-heading">
                <div class="col-sm-3 m-b-xs">  
                    <h1 class="m-n h3">Prescription</h1>                    
                </div>
                <div class="col-sm-6 m-b-xs">  
                    <table>
                        <tbody>
                            <tr>
                                <td class="legendColorBox">
                                    <div style="border:1px solid #ccc;padding:1px">
                                        <div style="width:4px;height:0;border:5px solid #f3c2c2;overflow:hidden"></div>
                                    </div>
                                </td>
                                <td class="legendLabel">Out of stock / prescribed quantity exceeds present stock in pharmacy.</td>
                            </tr>
                        </tbody>
                    </table>               
                </div>
                <div class="col-sm-3 m-b-xs pull-right right" ng-if="all_encounters.length > 1">
                    <b> Encounter Id : </b>&nbsp;&nbsp;&nbsp;
                    <select style="width: 50%" class="form-control pull-right" ng-model="data.encounter_id" ng-options="all_encounter.encounter_id as all_encounter.encounter_id for all_encounter in all_encounters| orderBy: encounter_id">
                    </select>
                </div>
                <div class="col-sm-3 m-b-xs pull-right right" ng-if="all_encounters.length == 1">
                    <b> Encounter Id : </b> {{enc.selected.encounter_id}}
                </div>
            </div>
            <div class="wrapper-md p-b">
                <div class="row">
                    <div class="col-sm-12">
                        <div ng-include="'tpl/blocks/alert.html'">
                            {% include 'tpl/blocks/alert.html' %}
                        </div>
                        <div class="panel panel-default"> 
                            <div class="row wrapper pb-sm pb-0">
                                <div class="col-sm-8" style="width:680px;" > 
                                    <div class="input-group">
                                        <input type="text"
                                               id="prescription_global_search"
                                               class="form-control prescription_search_input" 
                                               placeholder="Enter Your Prescription" 
                                               ng-model='prescription'
                                               />
                                        <div class="patient-search-result" ng-if="prescription != '' && prescription_lists" >
                                            <ul class="search-patientcont-header" id='prescriptioncont-header' ng-show="prescription_lists.length > 0">
                                                <li ng-repeat="(key, prescription_list) in prescription_lists" class="{{prescription_list.selected}}" ng-click="addGlobalSearch(prescription_list)">
                                                    <a data-key="{{key}}" ng-bind-html="prescription_list.prescription | highlight:prescription" href="javascript:void(0)" class="ng-binding {{(prescription_list.available_quantity <= 0) ? 'text-danger' : ''}}"></a>
                                                </li>
                                            </ul>
                                        </div>

                                        <!-- Advance Search -->
                                        <div class="input-group-btn dropdown" id="search-form-div">
                                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                <span class="caret"></span>
                                            </button>

                                            <div class="dropdown-menu pull-right prescrip-dropdown" ng-init="initForm()" id="search-form">
                                                <form id="advanceSearchForm" name="searchForm" class="form-horizontal form-validation" novalidate="">
                                                    <div class="panel panel-default">
                                                        <div class="panel-heading font-bold"> <i class="fa fa-medkit"></i> Search & Add</div>
                                                        <div class="panel-body">
                                                            <div class="row">
                                                                <div class="col-sm-3">
                                                                    <label>Drug Class</label>
                                                                    <input autocomplete="off"
                                                                           placeholder="Drug Class"
                                                                           type="text"
                                                                           class="form-control"
                                                                           name = "DrugClass"
                                                                           ng-model="addData.drug_class"
                                                                           ng-change = "watchDrug(true, this)"
                                                                           typeahead-editable="true"
                                                                           typeahead="drug as drug.drug_name for drug in drugs | filter:$viewValue"
                                                                           typeahead-on-select="getGeneric($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Generic </label>
                                                                    <select ng-show="generics.length > 0" class="form-control" name="Generic" ng-model="addData.generic" ng-options="generic as generic.generic_name for generic in generics| filter:$viewValue" data-ng-change="getProduct(false, null, null)">
                                                                        <option value="">Select Generic</option>
                                                                    </select>
                                                                    <input autocomplete="off"
                                                                           placeholder="Generic"
                                                                           type="text"
                                                                           class="form-control"
                                                                           ng-model="addData.generic"
                                                                           ng-hide="generics.length > 0"
                                                                           typeahead-editable="false"
                                                                           typeahead-min-length='2'
                                                                           typeahead="generic as generic.generic_name for generic in allgenerics | filter:$viewValue"
                                                                           typeahead-on-select="getDrugProduct($item, $model, $label)" />
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Product</label>
                                                                    <select class="form-control" name="Product" ng-model="addData.product" ng-options="product as product.full_name for product in products| filter:$viewValue" data-ng-change="setGeneric();
                                                                                        getRoutes(false, null, null)">
                                                                        <option value="">Select Product</option>
                                                                    </select>                                                                    
                                                                </div>
                                                                <div class="col-sm-3 freq_3_times_adv_form">
                                                                    <label> Freq</label>
                                                                    <div class="clearfix"></div>
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           name="masked" 
                                                                           ng-model="addData.frequency_3_0" 
                                                                           model-view-value="true" 
                                                                           class="form-control m-b"
                                                                           number-mask=""
                                                                           maxlength="4"
                                                                           required>
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           name="masked" 
                                                                           ng-model="addData.frequency_3_1" 
                                                                           model-view-value="true" 
                                                                           class="form-control m-b"
                                                                           number-mask=""
                                                                           maxlength="4"
                                                                           required>
                                                                    <input autocomplete="off" 
                                                                           type="text" 
                                                                           name="masked" 
                                                                           ng-model="addData.frequency_3_2" 
                                                                           model-view-value="true" 
                                                                           class="form-control m-b"
                                                                           number-mask=""
                                                                           maxlength="4"
                                                                           required>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> Route </label>
                                                                    <select class="form-control" name="Route" ng-model="addData.route" ng-options="route as route.route_name for route in routes| filter:$viewValue">
                                                                        <option value="">Select Route</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label>No.of.Days </label>
                                                                    <input autocomplete="off" type="text" ng-model="addData.number_of_days" class="form-control m-b" number-mask="">
                                                                </div>
                                                                <div class="col-sm-3">
                                                                    <label> </label>
                                                                    <br/>
                                                                    <button class="btn m-b-xs  btn-success save-btn" ng-click="addForm()"><i class="fa fa-plus"></i> Add</button>
                                                                    &nbsp;
                                                                    <button class="btn m-b-xs  btn-dark" ng-click="reset()"> <i class="fa fa-repeat"></i> Reset</button>
                                                                    &nbsp; </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <!-- Advance Search END-->
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <select class="form-control" ng-model="data.consultant_id" ng-options="doctor.user_id as doctor.fullname for doctor in doctors| orderBy: name" ng-change="getConsultantFreq()">
                                        <option value="">Select Consultant</option>
                                    </select>
                                </div>
                            </div>
                            <form editable-form name="tableform" name="prescForm" class="form-horizontal form-validation curPresForm" novalidate="" shown="true" onaftersave="saveForm()">
                                <div class="table-responsive">
                                    <div class="wrapper p-b">
                                        <div  style="min-height:200px" >
                                            <table class="table table-striped b-t b-light" id="prescription_item">
                                                <thead>
                                                    <tr>
                                                        <th width="30" align="left">Actions</th>
                                                        <th width="165" align="left">Product</th>
                                                        <th width="65" align="left">Route</th>
                                                        <th width="90" align="left">Frequency</th>
                                                        <th width="70" align="center">No.of Days</th>
                                                        <th width="25" align="center">Qty</th>
                                                        <!--<th width="50" align="center">Cost</th>-->
                                                        <th width="45" align="center">Remarks</th>
                                                        <th width="20" align="center">Fav</th>
                                                        <th width="35" align="right" class="text-right prescription-total-b-l">Total</th>
                                                    </tr>
                                                </thead>
                                                <tbody ng-hide="isLoading">                                                   
                                                    <tr class="{{(item.available_quantity == 0|| !item.in_stock) ? 'out_of_stock' : ''}}" ng-repeat="item in data.prescriptionItems" ng-init="key = item.item_key">
                                                        <td align="center">                                                         
                                                            <button type="button" class="label bg-info" ng-click="removeItem(item)"><i class=" fa fa-trash"></i></button>
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.product_name"
                                                                  e-index ="{{item.item_key}}"
                                                                  e-tabindex="2{{item.item_key}}1"
                                                                  e-class="form-control"
                                                                  e-name="product_name" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)" 
                                                                  e-ng-change="setProductId($data, item.item_key, tableform)" 
                                                                  e-ng-options="product.full_name as product.full_name for product in item.all_products | filter:$viewValue | filter:{generic_id : item.generic_id} : true" 
                                                                  e-required>
                                                                {{ showProduct(item)}}
                                                            </span>                                                            
                                                        </td>
                                                        <td>
                                                            <span editable-select="item.route" 
                                                                  e-index ="{{item.item_key}}"
                                                                  e-tabindex="2{{item.item_key}}2"
                                                                  e-class="form-control m-b"
                                                                  e-name="route" 
                                                                  e-form="tableform" 
                                                                  e-ng-change="setRouteId($data, item.item_key)" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-id="route"
                                                                  e-ng-options="route.route_name as route.route_name for route in item.description_routes | filter:$viewValue" 
                                                                  e-required>
                                                                {{ showRoute(item)}}
                                                            </span>                                                            
                                                        </td>
                                                        <td> 
                                                            <div id="freq_{{item.item_key}}_3" class="freq_div_{{item.item_key}} freq_3_times" style="width: 75%; float:left">
                                                                <span editable-text="item.frequency_3_0"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_3_0"
                                                                      e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '0')"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '3', '0')"
                                                                      e-required>
                                                                    {{ selectFreq('3', '0', item, item.item_key)}}
                                                                </span>
                                                                <span editable-text="item.frequency_3_1"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_3_1"
                                                                      e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '1')"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '3', '1')"
                                                                      e-required>
                                                                    {{ selectFreq('3', '1', item, item.item_key)}}
                                                                </span>
                                                                <span editable-text="item.frequency_3_2"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_3_2"
                                                                      e-ng-change="freqChange($data, '3', item, item.item_key, tableform, '2')"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '3', '2')"
                                                                      e-required>
                                                                    {{ selectFreq('3', '2', item, item.item_key)}}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{item.item_key}}_4" class="freq_div_{{item.item_key}} hide freq_4_times" style="width: 75%; float:left">
                                                                <span editable-text="item.frequency_4_0"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_4_0"
                                                                      e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 0)"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '4', '0')"
                                                                      e-required>
                                                                    {{ selectFreq('4', '0', item, item.item_key)}}
                                                                </span>
                                                                <span editable-text="item.frequency_4_1"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_4_1"
                                                                      e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 1)"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '4', '1')"
                                                                      e-required>
                                                                    {{ selectFreq('4', '1', item, item.item_key)}}
                                                                </span>
                                                                <span editable-text="item.frequency_4_2"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_4_2"
                                                                      e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 2)"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '4', '2')"
                                                                      e-required>
                                                                    {{ selectFreq('4', '2', item, item.item_key)}}
                                                                </span>
                                                                <span editable-text="item.frequency_4_3"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control m-b frequency_{{item.item_key}} freq_editable"
                                                                      e-name="masked" 
                                                                      e-model-view-value="true"
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_4_3"
                                                                      e-ng-change="freqChange($data, '4', item, item.item_key, tableform, 3)"
                                                                      e-select-on-click=""
                                                                      e-maxlength="4"
                                                                      e-number-mask=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, '4', '3')"
                                                                      e-required>
                                                                    {{ selectFreq('4', '3', item, item.item_key)}}
                                                                </span>
                                                            </div>
                                                            <div id="freq_{{item.item_key}}_txt" class="freq_div_{{item.item_key}} hide" style="width: 75%; float:left">
                                                                <span editable-text="item.frequency"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="2{{item.item_key}}3"
                                                                      e-class="form-control"
                                                                      e-name="masked" 
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="frequency_{{item.item_key}}_txt"
                                                                      e-ng-change="curPrescFreqSele($data, 'txt', item, item.item_key, 'change')"
                                                                      e-select-on-click=""
                                                                      onbeforesave="checkFrequency($data, item, item.item_key, 'txt')"
                                                                      e-required>
                                                                    {{ item.frequency || 'empty' }}
                                                                </span>
                                                            </div>
                                                            <div style="width: 20px; float:left">
                                                                <div class="input-group-btn dropdown">
                                                                    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                                                                        <span class="fa fa-ellipsis-v"></span>
                                                                    </button>
                                                                    <ul class="dropdown-menu curPrescFreq">
                                                                        <!-- Mask 3 -->
                                                                        <li ng-repeat="consFreq in currPresMask3| limitTo:3">
                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                        </li>
                                                                        <li class="dropdown-submenu" ng-if="currPresMask3.length > 3">
                                                                            <a tabindex="-1" href="#">More</a>
                                                                            <ul class="dropdown-menu">
                                                                                <li ng-repeat="consFreq in currPresMask3| limitTo:(3 - currPresMask3.length)">
                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                                </li>
                                                                            </ul>
                                                                        </li>
                                                                        <li class="divider"></li>
                                                                        <!-- Mask 4 -->
                                                                        <li ng-repeat="consFreq in currPresMask4| limitTo:3">
                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                        </li>
                                                                        <li class="dropdown-submenu" ng-if="currPresMask4.length > 3">
                                                                            <a tabindex="-1" href="#">More</a>
                                                                            <ul class="dropdown-menu">
                                                                                <li ng-repeat="consFreq in currPresMask4| limitTo:(3 - currPresMask4.length)">
                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                                </li>
                                                                            </ul>
                                                                        </li>
                                                                        <li class="divider"></li>
                                                                        <!-- Mask Txt -->
                                                                        <li ng-repeat="consFreq in currPresMaskTxt| limitTo:3">
                                                                            <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                        </li>
                                                                        <li class="dropdown-submenu" ng-if="currPresMaskTxt.length > 3">
                                                                            <a tabindex="-1" href="#">More</a>
                                                                            <ul class="dropdown-menu">
                                                                                <li ng-repeat="consFreq in currPresMaskTxt| limitTo:(3 - currPresMaskTxt.length)">
                                                                                    <a href ng-click="curPrescFreqSele(consFreq.freq_name, consFreq.freq_type, item, item.item_key, 'select')">{{consFreq.freq_name}}</a>
                                                                                </li>
                                                                            </ul>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td align="center">
                                                            <span editable-text="item.number_of_days"
                                                                  e-index ="{{item.item_key}}"
                                                                  e-tabindex="2{{item.item_key}}4"
                                                                  e-class="form-control"
                                                                  e-name="number_of_days" 
                                                                  e-form="tableform" 
                                                                  onbeforesave="checkInput($data)"
                                                                  e-autocomplete="off"
                                                                  e-id="number_of_days"
                                                                  e-ng-change="numberDaysChange($data, item, item.item_key, tableform)"
                                                                  e-number-mask=""
                                                                  e-select-on-click=""
                                                                  e-required>
                                                                {{ item.number_of_days || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td align="center">
                                                            <div id="qty_div_{{item.item_key}}">
                                                                <span editable-text="item.qty"
                                                                      e-index ="{{item.item_key}}"
                                                                      e-tabindex="1{{item.item_key}}5"
                                                                      e-class="form-control"
                                                                      e-name="qty" 
                                                                      e-form="tableform" 
                                                                      e-autocomplete="off"
                                                                      e-id="qty_{{item.item_key}}"
                                                                      e-ng-change="qtyChange($data, item, item.item_key, tableform)"
                                                                      e-number-mask=""
                                                                      e-select-on-click=""
                                                                      e-required>
                                                                    {{ item.qty || 'empty' }}
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <!--                                                        <td>
                                                                                                                    {{ item.price}}
                                                                                                                </td>-->
                                                        <td align="center">
                                                            <span editable-text="item.remarks"
                                                                  e-index ="{{item.item_key}}"
                                                                  e-tabindex="2{{item.item_key}}6"
                                                                  e-class="form-control"
                                                                  e-name="remarks" 
                                                                  e-form="tableform" 
                                                                  e-autocomplete="off"
                                                                  e-id="remarks"
                                                                  e-required>
                                                                {{ item.remarks || 'empty' }}
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <a href ui-toggle-class class="{{item.is_favourite ? 'active' : ''}}">
                                                                <i class="fa fa-star-o text-muted text" ng-click="updateFavourite(1, item.product_id)"></i>
                                                                <i class="fa fa-star text-info text-active" ng-click="updateFavourite(0, item.product_id)"></i> 
                                                            </a>
                                                        </td>
                                                        <td class="text-right prescription-total-b-l">
                                                            {{ item.total | number:2}}
                                                        </td>
                                                    </tr>                                                    
                                                </tbody>
                                                <tbody ng-show="isLoading">
                                                    <tr>
                                                        <td colspan="9" class="text-center"><i class="fa fa-spin fa-refresh"></i></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>                                     
                                    </div>
                                </div>
                                <footer class="panel-footer">
                                    <div class="row">
                                        <div class="table-responsive">
                                            <table class="table noborder">
                                                <tr>
                                                    <td width="785"  align="left">
                                                        <div class="form-horizontal">
                                                            <div class="form-inline">
                                                                <div class="form-group">
                                                                    <label for="exampleInputEmail2"><i class="fa fa-calendar"></i> <b> Next Vist </b></label> &nbsp; &nbsp;
                                                                    <input type="text" class="form-control multimonthdatepicker" ng-model="data.next_visit" ng-click="open($event)" prevent-enter="true" ng-change="setDayEmpty();
                                                                                    getDays();"/>    
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="exampleInputEmail2">
                                                                        &nbsp; &nbsp; <i class="fa fa-calendar-o"></i> <b> No.of.Days </b>
                                                                    </label> &nbsp;&nbsp;
                                                                    <input autocomplete="off" type="text" ng-model="data.number_of_days" class="form-control m-b w-100" number-mask="" ng-change="setDateEmpty();
                                                                                    getVisit();">     
                                                                </div>
                                                                <div class="form-group prescription-btns">   
                                                                    &nbsp; 
                                                                    <button class="btn btn-success save-btn-1" ng-click="getBtnId('save')"> 
                                                                        <i class="fa fa-check"></i> Save 
                                                                    </button> &nbsp;
                                                                    <button class="btn btn-dark save-print" ng-click="getBtnId('print')"> 
                                                                        <i class="fa fa-print"></i> Save & Print 
                                                                    </button> &nbsp;
                                                                    <button class="btn btn-dark" ng-click="clearPrescription()">  
                                                                        <i class="fa fa-times"></i> Clear 
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td width="180" align="right" class="prescription-total">  
                                                        <i class="fa fa-rupee"></i> 
                                                        <strong> {{ priceTotal() | number:2}}</strong>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </footer>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Prev presc -->
        <div class="col" ng-show="pres_status == 'prev'">
            <div class="bg-light lter b-b wrapper-md">
                <h1 class="m-n h3">Previous Prescription</h1>
            </div>
            <div class="wrapper-md p-b">
                <div class="panel panel-default">
                    <div class="row wrapper pb-sm">
                        <div class="col-sm-9">
                            <span ng-show="previousPresSelected > 0">
                                <button ng-click="addToCurrentPrescription()" class="btn btn-sm btn-primary">
                                    <i class="fa fa-retweet"></i> Add to current prescription
                                </button>
                            </span>
                        </div>
                        <div class="col-sm-3">
                            <div class="row">   
                                <div class="col-sm-9">
                                    <div class="input-group">
                                        <input placeholder="Filter by date" prevent-enter type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="filterdate" is-open="opened" datepicker-options="dateOptions" close-text="Close" max-date="maxDate" date-disabled="disabled(date, 'day')" ng-change="loadPrevPrescriptionsList(filterdate);"/>
                                        <span class="input-group-btn">
                                            <button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                    <button ng-click="filterdate = '';
                                                loadPrevPrescriptionsList()" class="btn m-b-xs  btn-dark">  
                                        <i class="fa fa-times"></i> 
                                    </button>
                                </div> 
                            </div>
                        </div>    
                    </div>
                    <div ng-include="'tpl/patient_prescription/_previous_prescription.html'">
                        {% include 'tpl/patient_prescription/_previous_prescription.html' %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Side Nav -->
        <div class="col w-sm pres-div bg-light dk b-r bg-auto" style="width:110px;">
            <div class="wrapper pres-right hidden-sm hidden-xs" id="email-menu">
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <li ng-repeat="fold in folds" ui-sref-active="active">
                        <a ui-sref="app.mail.list({fold:fold.filter})">
                            {{fold.name}}
                        </a>
                    </li>
                </ul>
                <ul class="nav nav-pills nav-stacked nav-sm">
                    <!--                    class="active4"-->
                    <li><a id="current_prescription" href="javascript:void(0)" ng-click="pres_status = 'current'"><i class="fa fa-medkit"></i> <br/>Prescription</a></li>
                    <li>
                        <a href="javascript:void(0)" class="sb-open-right" data-target="#vitals" ng-click="seen_vitals()"> 
                            <i class="fa fa-heartbeat"></i>  
                            <span class="badge badge-sm up bg-danger pull-right-xs" ng-show="unseen_vitals_count > 0">
                                {{unseen_vitals_count}}
                            </span>
                            <br>
                            Vitals
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0)" class="sb-open-right" data-target="#notes" ng-click="seen_notes()">
                            <i class="fa fa-pencil"></i>
                            <span class="badge badge-sm up bg-danger pull-right-xs" ng-show="unseen_notes_count > 0">
                                {{unseen_notes_count}}
                            </span> 
                            <br>
                            Notes
                        </a>
                    </li>
                    <li><a href="javascript:void(0)"><i class="fa fa-file-text"></i> <br/>Results </a></li>

                    <li><a href="javascript:void(0)" class="sb-open-right" data-target="#fav"><i class="fa fa-heart"></i> <br/> Favorites</a></li>
                    <li><a id="prev_prescription" href="javascript:void(0)" ng-click="pres_status = 'prev'"><i class="fa fa-history"></i> <br/>Prev-Prescr</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!--Print Bill-->
    <div id="Getprintval" ng-hide="true">
        <io-barcode id="patient_barcode" code="{{patientObj.patient_global_int_code}}" type="{{ type}}" options="barcodeOptions"></io-barcode>
        <img id="weather1" src="{{IRISOrgUrl}}/img/weather1.png" width="25" height="25" alt="" />
        <img id="weather2" src="{{IRISOrgUrl}}/img/weather2.png" width="25" height="25" alt="" />
        <img id="weather3" src="{{IRISOrgUrl}}/img/weather3.png" width="25" height="25" alt="" />
        <img id="weather4" src="{{IRISOrgUrl}}/img/weather4.png" width="25" height="25" alt="" />
    </div>     
</div>

<script>
    $(document).ready(function () {
        $('#search-form').on('click', function (e) {
            e.stopPropagation();
        });
        $.getScript("js/slidebars.js", function (data, textStatus, jqxhr) {
            slidebar();
        });
//        prescription right navigation
        $('.expand-notes').click(function (e) {
            $('#makeit-full').toggleClass('fullscreen');
            $('.note-full').toggleClass('fullscreen');
            var div_width = '-' + $('#makeit-full').css('width');
            $('#sb-site').css('transform', 'translate(' + div_width + ')');
            $('#sb-site').css('transition', 'none');
        });
        $(".multimonthdatepicker").datepicker({
            numberOfMonths: 2,
            showButtonPanel: true,
            dateFormat: 'yy-mm-dd',
            minDate: 0
        });
    });
    function slidebar() {
        $.slidebars({
            scrollLock: true
        });
    }
</script>